---
layout: default
title: "Float: Map Oriented Virtual Shop Application"
---
<h1>Float: Map Oriented Virtual Shop Application 
	(<a href="https://gitlab.com/JarvisAPI/float-server">Gitlab</a>)</h1>
<h2>Introduction</h2>
<p>My friend and I built an <a href="https://play.google.com/store/apps/details?id=com.floatapplication">Android application</a>
	where users can <a href="/login.jpg">login</a>, 
	<a href="/shop.jpg">open up shops</a> 
	and <a href="/shop_markers.jpg">place a marker on a map</a> to promote their shops. 
	Users can interact with other users using <a href="/messaging.jpg">in-app instant messaging</a>, 
	search up items using a <a href=/elastic_search.jpg">search bar that supports elastic search</a>
	or browse nearby products using <a href="/infinite_product.jpg">"infinite" product scrolling</a>.
	This project was built from scratch referencing various sources and documentations on the internet.
	More details available at <a href="https://play.google.com/store/apps/details?id=com.floatapplication">Google Play</a>. </p>

<h2>Demo/<a href="https://jcho7022.github.io/projects/chatbot">Detailed Messaging Demo</a></h2>
<iframe  width="980" height="660" src="https://www.youtube.com/embed/UMC1NTGTXZI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<h3>Why We Built This Application</h3>
<p>During my junior year, I felt that the classes I've taken were mostly theory based and wanted to learn something more practical. 
	These classes covered a wide range of topics such as software engineering, networking, 
	databases, DS and algorithms. However, I wanted to work with something outside of these courses
	and more hand on see what I was capable of doing. I wasn’t alone in this and by teaming up with my friend, 
	we decided to build something that could potentially be built into a product leading into a startup. 
	The idea was to help local small businesses as well as individuals promote their shops and interact
	with the customers all within a single application. </p>

<p>However, the start was difficult since there were no guidance or direction like the assignments from the CS courses.
	At first we didn't know anything such as how to build a server, what kind of frameworks to use, how to set up
	the development environment etc. We started with small sub projects and built our way up to bigger projects solving the challenges 
	one at a time. There were often frustrating times where it took hours to days to solve problems 
	but the joy that came of solving a problem pushed me to go forward to the next problem. Sooner or 
	later I found myself fully committed to this project rather than academics. I worked my way through
	this project part-time during the school year and further devoted full-time during the summer and winter
	break for over a year. </p>

<p>Overall, I had fun working on this project and learned far more than what I would have learned in class.
	The most fulfilling moments were when putting working features together and demoing and explaining
	each other's concepts and implementation of the features. From this project I discovered my particular 
	passion in back-end development and I'm planning to pursue a career in back-end software development. </p>

<p>We planned to monetize this project and build a start-up by sending out local ADs or offering special
	shop markers or shop store front displays for a fee. We tried to understand other somewhat similar
	crowdsourcing products such as Kijiji, Craigslist, Yelp, Letgo, Varagesale and implement something different and unique.
	This project is no longer under development.</p>

<h3>My Contributions</h3>
<ul class="contributions">	  
        <li>Designing, implementing, and testing RESTful APIs</li>
        <li>Architecting application components from front-end to back-end</li>
	<li>Setting up and integrating frameworks such as Docker, MySQL, Firebase, XMPP, OAuth</li>
	<li>Writing Docker, Docker-compose files, as well as shell scripts to automate deployment and testing</li>
	<li>Writing integration and unit tests</li>
	<li>Setting up user session with JWTs and user authentication</li>
	<li>Setting up HTTPS, TLS(XMPP) for client and server, and configuring NAT table(server was located in my dorm room)</li>
	<li>Building UI, app illustrations</li>
	<li>Refactoring code and code reviewing</li>
	<li>Version control</li>
	</ul>

<h2>Back End</h2>
<h3>Introduction</h3>
<p>The back end was bulit using Node.js Docker containers 
	following the <a href="https://microservices.io/patterns/microservices.html">microservice design pattern</a> 
	which was inspired by a Youtube video
	<a href="https://www.youtube.com/watch?v=CZ3wIuvmHeM">"Mastering Chaos - A Netflix Guide to Microservices"</a>.</p>
<img src="backend_diagram.jpg" alt="server_architecture" height="750px" width="750px">

<h3>Api-gateway</h3>
<ul class="Functionality">
				<li>All app requests except instant messaging requests are made to the api-gateway which is responsible of routing requests to the appropriate services</li>
				<li>Handles basic user authentication such as checking access tokens for tasks that require permission<br></li>
				<li>Maintains <a href="https://microservices.io/patterns/data/saga.html">data consistency</a> across services: <br>
          Some requests incorporate many services and to achieve modulation services do not communicate with each other. 
          As a result, the api-gateway is in charge of scheduling requests to multiple services. 
	  However, a request to a certain service may fail and to maintain
	  data consistency previous requests must be reverted by the api-gateway.<br>
          For example, when a user requests for sign-up the api-gateway:
	  <br>
          1.Requests to auth-service to create user
					<br>
          2.Requests to user-service to create user profile
					<br>
          3.Requests to chat-service to generate a xmpp account
					<br><br>
		
          However, if any of these steps fail, to achieve transaction atomicity, previous requests made must be reverted. The api-gateway uses a 
					<a href="https://microservices.io/patterns/data/saga.html">“saga state machine”</a> to achieve such task and maintain data consistency over distributed services. 
          For the example above if transaction #3 fails the saga state machine reverts transaction #2 and #1.
          </li>
				</ul>
   <img src="saga_state_machine.jpg" alt="saga_state_machine" height="800px" width="800px">

  <h3>Auth-service</h3>
	<ul class="Functionality">
		<li>Stores usernames and hashed passwords using the node.js <a href="https://www.npmjs.com/package/bcrypt">Bcrypt library</a></li>
		<li>Verifies passwords and grants refresh and access token <br>
			<img src="auth_user_session.jpg" alt="auth_user_session" height="800px" width="800px"></li>
	</ul>
      
   <h3>Chat-service(<a href="https://jcho7022.github.io/projects/chatbot/">Demo Video And Details</a>)</h3>
      <p>The chat-service has access to the MySQL database connected to ejabberd-service(XMPP) which allows custom http requests that
      the ejabberd framework does not support. For example, unread messages and dialogs lists cannot be synced among 
      multiple devices only using XMPP, however, by adding such sevice makes these features possible. Also,
      this service handles push notification message deilvery to users when they're disconnected to the XMPP server.</p>
      
   <h3>Ejabberd-service(<a href="https://jcho7022.github.io/projects/chatbot/">Demo Video And Details</a>)</h3>
      <p>A XMPP framework used to add an instant messaging functionality. Enabled features are:
	    <ul class="chat_features">	  
        <li><a href="https://xmpp.org/extensions/xep-0198.html">Stream Connection</a> which enables real-time detection of user disconnection for push notifications</li>
        <li><a href="https://xmpp.org/extensions/xep-0357.html">Push Notifications</a> which enables messages to be sent to user when disconnected</li>
	<li><a href="https://xmpp.org/extensions/xep-0136.html">Message Archiving</a>, <a href="https://xmpp.org/extensions/xep-0280.html">Message Carbons</a>
		which enables real-time message data syncing across multiple devices</li>
	<li>TLS 1.2 encryption with a self-signed certificate(application only trusts the server)</li>	    
	</ul>

   <h3>User-service</h3>
   <p>Stores and handles requests for user data such as profile image uri, background image uri, shop ownership, name.</p>

   <h3>Image-service</h3>
   <p>Stores and handles requests for image files and its permissions. Image names are stored as random MD5 hash strings.</p>

   <h3>Shop-service</h3>
   <p>Stores and handles requests for shop data such as its products, cover images.</p>

   <h3>Elastic-Search-service</h3>
   <p>This service handles app search requests made from the <a href="https://jcho7022.github.io/projects/float/elastic_search.jpg">app search bar</a>
       search requests are proxied from the shop-service.</p>

   <h3>Map-service</h3>
   <p>Stores and handles requests for shop locations on the map. Locations are stored and queried using mongoDB’s geospatial queries.</p>
    
     
   <h3>General development process using integration testing</h3>
<font size="5.8" font-family: 'Helvetica', 'Arial', 'Sans-Serif'>
	<ol type="1">
  		<li>Implement functions in repository</li>
  		<li>Iterate unit tests and fix code until all tests pass</li>
  		<li>Create endpoint in microservice</li>
		<li>Iterate integration test for service and fix code until all tests pass</li>
		<li>Create endpoint at api gateway</li>
		<li>Iterate integration test for api gateway and fix code until all tests pass</li>
		<li>Create hypermedia link</li>
		<li>Connect application with server</li>
	</ol>
</font>

<h3>Integration Test Demo(<a href="https://gitlab.com/JarvisAPI/float-server/tree/develop/auth-service/integration-test">Tests</a>)</h3>
<iframe width="980" height="660" src="https://www.youtube.com/embed/Dn0uajOOrVQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<br><br><br>
 <p> </p>

